{"version":3,"file":"driver.mjs","mappings":"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","names":["Stack","TExit","STM","STMDriver","constructor","self","journal","fiberId","r0","envStack","unwindStack","error","isRetry","result","undefined","contStack","cont","value","previous","_typeId","STMOnFailureTypeId","onFailure","STMOnRetryTypeId","onRetry","run","curr","exit","k","STMSucceedTypeId","a","succeed","apply","STMSucceedNowTypeId","STMProvideSomeTypeId","f","ensuring_","stm","succeedWith","STMOnSuccessTypeId","STMEffectTypeId","e","isFailException","fail","isRetryException","retry","isDieException","die"],"sourceRoot":"","sources":["../../../../_src/Transactional/STM/_internal/driver.ts"],"sourcesContent":[null]}