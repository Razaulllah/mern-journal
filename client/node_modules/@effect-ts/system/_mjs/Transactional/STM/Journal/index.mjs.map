{"version":3,"file":"index.mjs","mappings":"AAAA;AAEA,OAAO,6BAAP;AAEA,OAAO,KAAKA,EAAZ,MAAoB,kDAApB;AACA,OAAO,KAAKC,CAAZ,MAAmB,2BAAnB;AAGA,SAASC,gBAAT,QAAiC,sCAAjC;AAEA,SAASC,SAAT,QAA0B,yBAA1B;AAGA,SAASC,SAAT,EAAoBC,UAApB,EAAgCC,WAAhC,EAA6CC,aAA7C,QAAkE,oBAAlE;AAEA,SAASC,IAAT,EAAeC,UAAf,EAA2BC,OAA3B,EAAoCC,aAApC,QAAyD,wBAAzD;AAOA;;;;AAGA,OAAM,SAAUC,mBAAV,CAA8BC,OAA9B,EAA8C;AAClD,QAAMC,KAAK,GAAY,IAAIC,GAAJ,EAAvB;;AACA,OAAK,MAAMC,KAAX,IAAoBH,OAApB,EAA6B;AAC3BC,SAAK,CAACG,GAAN,CACED,KAAK,CAAC,CAAD,CADP,EAEEA,KAAK,CAAC,CAAD,CAAL,CAASE,GAAT,CAAcC,CAAD,IAAOA,CAAC,CAACC,IAAF,EAApB,CAFF;AAID;;AACD,SAAO,MAAK;AACVP,WAAO,CAACQ,KAAR;;AACA,SAAK,MAAML,KAAX,IAAoBF,KAApB,EAA2B;AACzBD,aAAO,CAACI,GAAR,CAAYD,KAAK,CAAC,CAAD,CAAjB,EAAsBA,KAAK,CAAC,CAAD,CAA3B;AACD;AACF,GALD;AAMD;AAED;;;;AAGA,OAAM,SAAUM,aAAV,CAAwBT,OAAxB,EAAwC;AAC5C,OAAK,MAAMG,KAAX,IAAoBH,OAApB,EAA6B;AAC3BG,SAAK,CAAC,CAAD,CAAL,CAASE,GAAT,CAAcC,CAAD,IAAOA,CAAC,CAACI,MAAF,EAApB;AACD;AACF;AAED;;;;;;;AAMA,OAAM,SAAUC,cAAV,CAAyBX,OAAzB,EAAyC;AAC7C,MAAIY,GAAG,GAAsB,IAA7B;;AACA,OAAK,MAAMT,KAAX,IAAoBH,OAApB,EAA6B;AAC3BY,OAAG,GAAGT,KAAK,CAAC,CAAD,CAAL,CAASE,GAAT,CAAcC,CAAD,IAAQA,CAAC,CAACO,SAAF,KAAgB,GAAhB,GAAsBP,CAAC,CAACQ,SAAF,KAAgB,IAAhB,GAAuBF,GAAlE,CAAN;;AACA,QAAIA,GAAG,KAAK,GAAZ,EAAiB;AACf,aAAOA,GAAP;AACD;AACF;;AACD,SAAOA,GAAP;AACD;AAED,OAAO,MAAMG,YAAY,gBAAG5B,EAAE,CAAC6B,IAAH,EAArB;AAEP;;;;;AAIA,OAAM,SAAUC,YAAV,CAAuBjB,OAAvB,EAAuC;AAC3C,QAAMkB,QAAQ,GAAqB,IAAIhB,GAAJ,EAAnC;;AAEA,OAAK,MAAMC,KAAX,IAAoBH,OAApB,EAA6B;AAC3B,UAAMmB,IAAI,GAAoBhB,KAAK,CAAC,CAAD,CAAL,CAASE,GAAT,CAAcC,CAAD,IAAOA,CAAC,CAACa,IAAtB,CAA9B;AACA,UAAMC,KAAK,GAAGD,IAAI,CAACE,IAAL,CAAUC,GAAxB;;AACA,SAAK,MAAMD,IAAX,IAAmBD,KAAnB,EAA0B;AACxBF,cAAQ,CAACd,GAAT,CAAaiB,IAAI,CAAC,CAAD,CAAjB,EAAsBA,IAAI,CAAC,CAAD,CAA1B;AACD;;AACDF,QAAI,CAACE,IAAL,CAAUjB,GAAV,CAAcW,YAAd;AACD;;AAED,SAAOG,QAAP;AACD;AAED;;;;AAGA,OAAM,SAAUK,SAAV,CAAoBH,KAApB,EAA2C;AAC/C,QAAMI,WAAW,GAAGC,KAAK,CAACC,IAAN,CAAWN,KAAK,CAACO,OAAN,EAAX,EAA4BC,IAA5B,CAAiC,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAC,CAAC,CAAD,CAAnD,CAApB;;AACA,OAAK,MAAM,CAACxB,CAAD,EAAIe,IAAJ,CAAX,IAAwBG,WAAxB,EAAqC;AACnCH,QAAI;AACL;AACF;AAED;;;;AAGA,OAAM,SAAUU,aAAV,CAA8BC,EAA9B,EAA8ChC,OAA9C,EAA8D;AAClE,QAAMoB,KAAK,GAAGH,YAAY,CAACjB,OAAD,CAA1B;;AACA,MAAIoB,KAAK,CAACa,IAAN,GAAa,CAAjB,EAAoB;AAClB5C,oBAAgB,CAAC,MAAMkC,SAAS,CAACH,KAAD,CAAhB,CAAhB;AACD;;AACD,SAAO,IAAIzB,IAAJ,CAASqC,EAAT,CAAP;AACD;AAED;;;;;AAIA,OAAM,SAAUE,OAAV,CAAkBC,KAAlB,EAAgCnC,OAAhC,EAAkDoC,UAAlD,EAAkE;AACtE,MAAIC,KAAK,GAAG,KAAZ;;AAEA,OAAK,MAAMlC,KAAX,IAAoBH,OAApB,EAA6B;AAC3B,UAAMmB,IAAI,GAAGhB,KAAK,CAAC,CAAD,CAAL,CAASE,GAAT,CAAcC,CAAD,IAAOA,CAAC,CAACa,IAAtB,CAAb;AACA,UAAMmB,OAAO,GAAGnB,IAAI,CAACE,IAAL,CAAUC,GAA1B;;AACA,QAAI,CAACnC,EAAE,CAACoD,IAAH,CAAQD,OAAR,EAAiBH,KAAjB,CAAL,EAA8B;AAC5B,YAAMK,OAAO,GAAGrD,EAAE,CAACsD,IAAH,CAAQH,OAAR,EAAiBH,KAAjB,EAAwBC,UAAxB,CAAhB;AACAjB,UAAI,CAACE,IAAL,CAAUjB,GAAV,CAAcoC,OAAd;AACAH,WAAK,GAAG,IAAR;AACD;AACF;;AAED,SAAOA,KAAP;AACD;AAED;;;;AAGA,OAAM,SAAUK,oBAAV,CACJC,UADI,EAEJC,UAFI,EAEe;AAEnB,QAAMC,SAAS,GAAY,IAAI3C,GAAJ,EAA3B;;AACA,OAAK,MAAMC,KAAX,IAAoByC,UAApB,EAAgC;AAC9B,UAAME,GAAG,GAAG3C,KAAK,CAAC,CAAD,CAAjB;AACA,UAAM4C,KAAK,GAAG5C,KAAK,CAAC,CAAD,CAAnB;;AACA,SACE;AACA,KAACwC,UAAU,CAACK,GAAX,CAAeF,GAAf,CAAD,IACA;AACA;AACA;AACA;AACA,KAACC,KAAK,CAAC1C,GAAN,CAAWC,CAAD,IAAOA,CAAC,CAAC2C,KAAnB,CAPH,EAQE;AACAJ,eAAS,CAACzC,GAAV,CAAc0C,GAAd,EAAmBC,KAAnB;AACD;AACF;;AACD,SAAOF,SAAP;AACD;AAED,OAAM,SAAUK,SAAV,CACJC,OADI,EAEJC,GAFI,EAGJC,CAHI,EAGA;AAEJ,QAAMrD,OAAO,GAAY,IAAIE,GAAJ,EAAzB;AACA,QAAM6C,KAAK,GAAG,IAAIzD,SAAJ,CAAc8D,GAAd,EAAmBpD,OAAnB,EAA4BmD,OAA5B,EAAqCE,CAArC,EAAwCC,GAAxC,EAAd;AACA,QAAMC,QAAQ,GAAG5C,cAAc,CAACX,OAAD,CAA/B;;AACA,MAAIuD,QAAQ,KAAK,IAAjB,EAAuB;AACrB9C,iBAAa,CAACT,OAAD,CAAb;AACD,GAFD,MAEO,IAAIuD,QAAQ,KAAK,GAAjB,EAAsB;AAC3B,UAAM,IAAIC,KAAJ,CAAU,sBAAV,CAAN;AACD;;AACD,UAAQT,KAAK,CAACU,OAAd;AACE,SAAKhE,WAAL;AAAkB;AAChB,eAAO,IAAII,OAAJ,CAAYG,OAAZ,CAAP;AACD;;AACD,SAAKN,aAAL;AAAoB;AAClB,eAAOqC,aAAa,CAAC3C,CAAC,CAACsE,OAAF,CAAUX,KAAK,CAACA,KAAhB,CAAD,EAAyB/C,OAAzB,CAApB;AACD;;AACD,SAAKR,UAAL;AAAiB;AACf,eAAOuC,aAAa,CAAC3C,CAAC,CAACuE,IAAF,CAAOZ,KAAK,CAACA,KAAb,CAAD,EAAsB/C,OAAtB,CAApB;AACD;;AACD,SAAKT,SAAL;AAAgB;AACd,eAAOwC,aAAa,CAAC3C,CAAC,CAACwE,GAAF,CAAMb,KAAK,CAACA,KAAZ,CAAD,EAAqB/C,OAArB,CAApB;AACD;AAZH;AAcD;;AAED,SAAS6D,iBAAT,CACE7B,EADF,EAEE8B,CAFF,EAGEC,IAHF,EAGqB;AAEnBA,MAAI,CAAC3D,GAAL,CAAS,IAAT;AACA0D,GAAC,CAAC9B,EAAD,CAAD;AACD;;AACD,SAASgC,gBAAT,CACEb,OADF,EAEEC,GAFF,EAGEjB,KAHF,EAIE4B,IAJF,EAKEV,CALF,EAMES,CANF,EAOEG,KAPF,EAQEjE,OARF,EAQkB;AAEhB;AACA,SAAO,CAAP,EAAU;AACRkC,WAAO,CAACC,KAAD,EAAQnC,OAAR,EAAiB,MACtBkE,cAAc,CAACC,SAAD,EAAYhB,OAAZ,EAAqBC,GAArB,EAA0BjB,KAA1B,EAAiC4B,IAAjC,EAAuCV,CAAvC,CAAd,CAAwDS,CAAxD,CADK,CAAP;;AAGA,QAAIjD,SAAS,CAACb,OAAD,CAAb,EAAwB;AACtB,YAAMoE,CAAC,GAAGlB,SAAS,CAACC,OAAD,EAAUC,GAAV,EAAeC,CAAf,CAAnB;;AACA,cAAQe,CAAC,CAACX,OAAV;AACE,aAAK7D,UAAL;AAAiB;AACfiE,6BAAiB,CAACO,CAAC,CAACpC,EAAH,EAAO8B,CAAP,EAAUC,IAAV,CAAjB;AACA;AACD;;AACD,aAAKjE,aAAL;AAAoB;AAClB,kBAAM+C,SAAS,GAAGH,oBAAoB,CAACuB,KAAD,EAAQG,CAAC,CAACpE,OAAV,CAAtC;;AAEA,gBAAI6C,SAAS,CAACZ,IAAV,GAAiB,CAArB,EAAwB;AACtB,mBAAK,MAAM9B,KAAX,IAAoB0C,SAApB,EAA+B;AAC7BoB,qBAAK,CAAC7D,GAAN,CAAUD,KAAK,CAAC,CAAD,CAAf,EAAoBA,KAAK,CAAC,CAAD,CAAzB;AACD;;AACDH,qBAAO,GAAG6C,SAAV;AACD;;AAED;AACD;AAhBH;AAkBD,KApBD,MAoBO;AACL;AACD;AACF;AACF;;AAED,OAAM,SAAUqB,cAAV,CACJlE,OADI,EAEJmD,OAFI,EAGJC,GAHI,EAIJjB,KAJI,EAKJ4B,IALI,EAMJV,CANI,EAMA;AAEJ,SAAQS,CAAD,IAAyC;AAC9C,QAAI,CAACC,IAAI,CAACzC,GAAV,EAAe;AACb,UAAItB,OAAO,IAAI,IAAf,EAAqB;AACnB,cAAMoE,CAAC,GAAGlB,SAAS,CAACC,OAAD,EAAUC,GAAV,EAAeC,CAAf,CAAnB;;AACA,gBAAQe,CAAC,CAACX,OAAV;AACE,eAAK7D,UAAL;AAAiB;AACfiE,+BAAiB,CAACO,CAAC,CAACpC,EAAH,EAAO8B,CAAP,EAAUC,IAAV,CAAjB;AACA;AACD;;AACD,eAAKjE,aAAL;AAAoB;AAClBkE,8BAAgB,CAACb,OAAD,EAAUC,GAAV,EAAejB,KAAf,EAAsB4B,IAAtB,EAA4BV,CAA5B,EAA+BS,CAA/B,EAAkCM,CAAC,CAACpE,OAApC,EAA6CoE,CAAC,CAACpE,OAA/C,CAAhB;AACA;AACD;AARH;AAUD,OAZD,MAYO;AACLgE,wBAAgB,CAACb,OAAD,EAAUC,GAAV,EAAejB,KAAf,EAAsB4B,IAAtB,EAA4BV,CAA5B,EAA+BS,CAA/B,EAAkC9D,OAAlC,EAA2CA,OAA3C,CAAhB;AACD;AACF;AACF,GAlBD;AAmBD;AAED;;;;AAGA,OAAM,SAAUqE,OAAV,CAAkBrE,OAAlB,EAAkC;AACtC,MAAIsE,KAAK,GAAG,IAAZ;;AACA,OAAK,MAAMnE,KAAX,IAAoBH,OAApB,EAA6B;AAC3BsE,SAAK,GAAGnE,KAAK,CAAC,CAAD,CAAL,CAASE,GAAT,CAAcC,CAAD,IAAOA,CAAC,CAAC+D,OAAF,EAApB,CAAR;;AACA,QAAI,CAACC,KAAL,EAAY;AACV,aAAOA,KAAP;AACD;AACF;;AACD,SAAOA,KAAP;AACD;AAED;;;;AAGA,OAAM,SAAUzD,SAAV,CAAoBb,OAApB,EAAoC;AACxC,SAAO,CAACqE,OAAO,CAACrE,OAAD,CAAf;AACD","names":["HM","T","defaultScheduler","STMDriver","DieTypeId","FailTypeId","RetryTypeId","SucceedTypeId","Done","DoneTypeId","Suspend","SuspendTypeId","prepareResetJournal","journal","saved","Map","entry","set","use","_","copy","clear","commitJournal","commit","analyzeJournal","val","isInvalid","isChanged","emptyTodoMap","make","collectTodos","allTodos","tref","todos","todo","get","execTodos","todosSorted","Array","from","entries","sort","x","y","completeTodos","io","size","addTodo","txnId","todoEffect","added","oldTodo","has_","newTodo","set_","untrackedTodoTargets","oldJournal","newJournal","untracked","key","value","has","isNew","tryCommit","fiberId","stm","r","run","analysis","Error","_typeId","succeed","fail","die","completeTryCommit","k","done","suspendTryCommit","accum","tryCommitAsync","undefined","v","isValid","valid"],"sourceRoot":"","sources":["../../../../_src/Transactional/STM/Journal/index.ts"],"sourcesContent":[null]}