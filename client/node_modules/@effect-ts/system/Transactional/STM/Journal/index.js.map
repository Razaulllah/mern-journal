{"version":3,"file":"index.js","mappings":"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","names":["prepareResetJournal","journal","saved","Map","entry","set","use","_","copy","clear","commitJournal","commit","analyzeJournal","val","isInvalid","isChanged","emptyTodoMap","HM","make","collectTodos","allTodos","tref","todos","todo","get","execTodos","todosSorted","Array","from","entries","sort","x","y","completeTodos","io","size","Done","addTodo","txnId","todoEffect","added","oldTodo","has_","newTodo","set_","untrackedTodoTargets","oldJournal","newJournal","untracked","key","value","has","isNew","tryCommit","fiberId","stm","r","STMDriver","run","analysis","Error","_typeId","RetryTypeId","Suspend","SucceedTypeId","T","succeed","FailTypeId","fail","DieTypeId","die","completeTryCommit","k","done","suspendTryCommit","accum","tryCommitAsync","undefined","v","DoneTypeId","SuspendTypeId","isValid","valid"],"sourceRoot":"","sources":["../../../_src/Transactional/STM/Journal/index.ts"],"sourcesContent":[null]}